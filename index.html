<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IIIF Multi Viewer</title>
    <!-- Tailwind CSS CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <body
    class="bg-gradient-to-r from-blue-500 to-teal-500 min-h-screen flex items-center justify-center"
  >
    <div class="w-full max-w-2xl p-8 space-y-8 bg-white rounded-lg shadow-2xl">
      <div>
        <h2 class="font-bold text-3xl text-gray-800 mb-4">IIIF Multi Viewer</h2>
        <p class="text-gray-600">
          IIIF Curation List（を含む）URLを入力してください。
        </p>
      </div>
      <form class="space-y-6">
        <div>
          <label
            for="iiif-manifest-url"
            class="block text-sm font-medium text-gray-700 mb-1"
            >IIIF Curation URL</label
          >
          <input
            id="iiif-manifest-url"
            type="text"
            placeholder="https://mp.ex.nii.ac.jp/api/curation/json/528810d2-4e28-4a46-910c-c9b517f86943"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
          />
        </div>
        <div>
          <button
            type="button"
            id="submit-button"
            class="w-full flex justify-center py-3 px-6 border border-transparent rounded-md shadow-sm text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
          >
            送信
          </button>
        </div>
      </form>
      <div>
        <h3 class="font-bold text-2xl text-gray-800">登録例</h3>
        <div class="space-y-2 text-gray-600">
          <p>登録例を以下に示します。以下のURLをご参照ください。</p>
          <div class="bg-gray-100 p-4 rounded-md">
            <p>
              <code
                >https://mp.ex.nii.ac.jp/api/curation/json/528810d2-4e28-4a46-910c-c9b517f86943</code
              >
            </p>
            <hr class="my-4" />
            <p>
              <code
                >http://codh.rois.ac.jp/software/iiif-curation-viewer/demo/?curation=https://mp.ex.nii.ac.jp/api/curation/json/528810d2-4e28-4a46-910c-c9b517f86943&lang=ja</code
              >
            </p>
          </div>
        </div>
      </div>
    </div>

    <script>
      const isFormatOk = (url) => {
        return url.startsWith("http");
      };

      document.addEventListener("DOMContentLoaded", function () {
        // 現在のURLからクエリパラメータを取得
        const params = new URLSearchParams(window.location.search);
        // 'u'パラメータの値を取得
        const uValue = params.get("u");
        // 'u'パラメータが存在する場合は、input要素に値をセット
        if (uValue) {
          document
            .getElementById("iiif-manifest-url")
            .setAttribute("value", uValue);
        }

        const iiifManifestUrlInput =
          document.getElementById("iiif-manifest-url");

        iiifManifestUrlInput.addEventListener("blur", function () {
          // ここに実行したい処理を書く

          // 正規表現で?curation=aaa&のaaaの部分を取得したい

          let curationUri = iiifManifestUrlInput.value;

          if (iiifManifestUrlInput.value.match(/curation=([^&]+)/)) {
            curationUri =
              iiifManifestUrlInput.value.match(/curation=([^&]+)/)[1];
          }

          if (isFormatOk(curationUri)) {
            iiifManifestUrlInput.value = curationUri;
          }

          // 例: 入力されたテキストに基づいて何かの処理を行う
          // if (iiifManifestUrlInput.value.length > 0) {
          //     // テキストが入力されたら何かの処理を行う
          // } else {
          //     // テキストが空の場合は別の処理を行う
          // }
        });
      });

      const submitButton = document.getElementById("submit-button");

      submitButton.addEventListener("click", function () {
        const iiifManifestUrlInput =
          document.getElementById("iiif-manifest-url");

        isFormatOk(iiifManifestUrlInput.value)
          ? (window.location.href = `https://nakamura196.github.io/icc2/search?u=${iiifManifestUrlInput.value}`)
          : alert("URLの形式が正しくありません。");

        // location.href = `https://nakamura196.github.io/icc2/search?u=${iiifManifestUrlInput.value}`;
      });
    </script>
  </body>
</html>
